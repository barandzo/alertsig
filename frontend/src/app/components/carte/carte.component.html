<div class="carte-container">

  <!-- Carte Leaflet -->
  <div id="map"></div>

  <!-- Panel dÃ©tail incident -->
  <div class="detail-panel" [class.open]="selectedIncident">
    <ng-container *ngIf="selectedIncident">

      <!-- Header -->
      <div class="detail-header">
        <div class="detail-header-left">
          <div class="detail-icon">{{ selectedIncident.type_emoji }}</div>
          <div>
            <div class="detail-type">{{ selectedIncident.type_libelle }}</div>
            <div class="detail-time">
              {{ selectedIncident.created_at | date:'dd/MM/yyyy Ã  HH:mm' }}
            </div>
          </div>
        </div>
        <button class="close-btn" (click)="fermerDetail()">âœ•</button>
      </div>

      <!-- Titre -->
      <div class="detail-titre" *ngIf="selectedIncident.titre">
        {{ selectedIncident.titre }}
      </div>

      <!-- Statut + SÃ©vÃ©ritÃ© -->
      <div class="detail-badges">
        <span class="badge" [ngClass]="getStatutClass(selectedIncident.statut)">
          {{ getStatutLabel(selectedIncident.statut) }}
        </span>
        <span class="badge badge-severite">
          {{ getSeveriteLabel(selectedIncident.severite) }}
        </span>
      </div>

      <!-- Infos -->
      <div class="detail-section">
        <div class="section-title">INFORMATIONS</div>
        <div class="detail-row">
          <span class="key">SignalÃ© par</span>
          <span class="val">{{ selectedIncident.signale_par_nom }}</span>
        </div>
        <div class="detail-row">
          <span class="key">Confirmations</span>
          <span class="val">âœ“ {{ selectedIncident.nb_confirmations }}</span>
        </div>
        <div class="detail-row">
          <span class="key">Score confiance</span>
          <span class="val">{{ selectedIncident.score_confiance }}%</span>
        </div>
      </div>

      <!-- Localisation -->
      <div class="detail-section">
        <div class="section-title">LOCALISATION</div>
        <div class="detail-row">
          <span class="key">Adresse</span>
          <span class="val">{{ selectedIncident.adresse || 'â€”' }}</span>
        </div>
        <div class="detail-row">
          <span class="key">Quartier</span>
          <span class="val">{{ selectedIncident.quartier || 'â€”' }}</span>
        </div>
        <div class="detail-row">
          <span class="key">CoordonnÃ©es</span>
          <span class="val coord">
            {{ selectedIncident.latitude?.toFixed(4) }},
            {{ selectedIncident.longitude?.toFixed(4) }}
          </span>
        </div>
      </div>

      <!-- Description -->
      <div class="detail-section" *ngIf="selectedIncident.description">
        <div class="section-title">DESCRIPTION</div>
        <p class="description">{{ selectedIncident.description }}</p>
      </div>

      <!-- Zone critique -->
      <div class="zone-critique-badge" *ngIf="selectedIncident.est_zone_critique">
        ðŸš¨ Zone critique â€”
        {{ selectedIncident.nb_incidents_proches + 1 }} incidents dans 1km
      </div>

    </ng-container>
  </div>

</div>